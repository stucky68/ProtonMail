package main

import (
	"ProtonMail/srp"
	"encoding/base64"
	"fmt"
	"github.com/ProtonMail/gopenpgp/v2/crypto"
	"strings"
	"testing"

)


func TestNewAuth(t *testing.T) {

	service := ProtonMailService{
		UserName: "6992917",
		PassWord: "QpfzEwZG3Lt6!$f",
	}

	salt, _ := base64.StdEncoding.DecodeString("hOkBf1JPQwzqwRIp0LM9tg==")
	generatedMailboxPassword, _ := srp.MailboxPassword(service.PassWord, salt)
	generatedMailboxPassword = strings.ReplaceAll(generatedMailboxPassword, "$2y$10$", "")
	generatedMailboxPassword = strings.ReplaceAll(generatedMailboxPassword, string(Radix64Encode(salt)), "")

	fmt.Println(generatedMailboxPassword)

	pgpMessage, err := crypto.NewPGPSplitMessageFromArmored("-----BEGIN PGP MESSAGE-----\nVersion: ProtonMail\n\nwcBMA737zsABniVYAQf/aXESWNmyjj9FhyGEYpPHNr0yqd4VkjLRy9O6B5nL\nCGKx52siCIls7TE2qYCwocGaefPRyHfP1YuRK+GVK6zL+ajZbNDp7Q96CXos\nTV/0Rgt4r9jLO8iwDL2W63I6vWbLC0aoaPjTYnFYm7/QnQEALyKj2lMdxuf6\nuVNTCunjgRg4Pnqe1ZVGJVE53dYAalUvkDSfPBHp3VO4xpIYnAHu6Yp30sUK\nrVm/7OfJsj6csHX7Ar3OAcH615Sb3i2biAghv29oT2VY0EBxMo4SUm81NJZl\nYXI6AEXjckUzXpFo1JlfAh747DAiFd3hnvmuW1SigC+nSD493OIyg0qd8bpH\nUtLBZAGaTere6Um+tQfsz8cosl0KhlUROcB/bbHFSA+21TN+dssJX3VW8i65\nhNYl5wff1lnYnCnfqc+XuF470Vjrrp40fNI8f4RN507+l/uMiacJCxjag9rL\nM7S1o2dYNE+bnXpfBwNT/N8H0W6D1LGMjIGtzwjDZdulCsPdvWsl+xmNPGcH\nCNyk2B7558cPKi2uPg3hA6KTFjNk3CUwqAZ98EFwhrsEmUbVqy20Gp2ZqEc6\naIo9pYd8kPNIBrW05GLBoLeNPHaVsTqQWl6TMPicfBw5y3vu9YdfUfLOQ0rI\nPh/Xc3nFnu138VdnFMu3QvCKcj1FiVnM8uZecOyymNF5as+gpGhf4+9oQDHi\nuDFN0bKtu3vINiqvviuyph2lmO/uFma0oYnZ2NJbGkWanApu8JzVn3Al9Wpf\nDCIz8+XFuPHAu5SRoh6qiUI/EQm+bFpldOmhqlsfmwo2gXo27JDm7m8GB5wu\nCrhSt9iQ6XWX+28dJyeYVIkVf+O+mCTv504el0UPCUUTQSEZPWsNFJ82t8Q6\nWzMj5s3P5t6NWBxP+2B3hab0NuhwdrzYVFOBRTK5U+nsiwSdb4raMtRlI8it\nT5mjMLu8tGgLLA7/ZywnHJcAaAbnoug9P7Yv/Osb1ZvspnE3pECtB2lvXi6F\nDM5WOahI3X/AC9eMd0anZIQmzJbDIsCvSeaLDiCnEM4WbpTQEkqu+rjXoLUh\n5TnvfhaHEbCKYz+a\n=t73G\n-----END PGP MESSAGE-----")
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println(pgpMessage.DataPacket, err)
	fmt.Println(pgpMessage.KeyPacket)

	privaetKey, _ := crypto.NewKeyFromArmored("-----BEGIN PGP PRIVATE KEY BLOCK-----\nVersion: ProtonMail\n\nxcMGBF8mYHIBCADM1W3cpOZsPZ/51Vu2YkhZHpsHB15ILxqBdixM4O700bQr\nQOFh3Ojp/fm4qFQsVcCmQBODOBIgcFN4Zu3rJviQ7pRTbFcEy9KwUMpldcEz\ndhN4z3aMJSmUST47Ub/pMKc5YLL/8PssYoQsEOqyxNHafO9Kp7vphQ381IcE\nalb0/ijMeUk5aaSO+ikUzfCMKBesVfmuf9EUVF9/6ovMAEqhUomsWkrihYbk\nMLIMYE+9T5upsAZ9igwLhfdNmGw6t8DK2U0kdLD6iFONqOZuNN1y4g5M6yvD\n9PS09VV0Ta4nzPo4EcGIAzUfVCP0VxGp3pEdzPlQo7z4Oq+ilgYfhZFpABEB\nAAH+CQMIDRhK29NUkzZgZ8duu+KcVvtKStcnnanMPoW6dWZ4l6lpST82ESVH\nFzLYjCvkSieSjm92ddvPXg9vAVo7kPZawVfLvjoUnuKO6Usp9kPpjB3sGqbc\nXm3TnFLd3X2hs3r2kA2FN1oX6bpVMAYAPArkMLl14nQh/J/28NALX15OlJvn\nuFs2anJ9NI53/84U1KQzrThzM7KVuTGzgPbyCHXiRk+EJRHayBhD9vgXV0QC\n42En67eIdg86lWTfnsQKsVDllPzH8FTJ110F6zut3YZtYbaJ6J1pxv1FvRsF\n23tdCz263/oMTCVdOr2dXlmWPpGd/ST7qcWOjJhwGwINc6jYfz1se+7JRrA7\nVBAuGmnHzHYdFp/v0kdQ6Anvo0HMPTGCE2sJUE6Cqlv685gXEtFT4zpdck7i\nFd4wVDCnB+pvzts6h244X2ulAhOGunzvLJBw0yvCaSLyNOYikq3It5OfGRO4\nIj9EU1XoM04E5Q5kFWfUrHVs7n+imLmLXGPtWkkJS4+gr8jOqZt9wkS+BuQr\nGCfDWq/7NEefInIb4BUUL65vKZlerWQRA42GvfebkwreZyhNx0udU4da4nCZ\nYSI/lUk55qcQ4wbhajQfRGTL3zDnpeFER++TfOBuQAlMzyX3BI9LEXUmDCeR\nRlK+b7y15PWL4hQlwvmmdUVYPBfWsDHXapxESgIkz6RyG2wrvJHGvADkU3tQ\ndjspu6EutDPx6pFiiirWwNZnKhD5IvkBh4RLD193f/3ro/MMOz1wr1RR8rV8\n0c7C/cLJRuDTBg9OyiHraR6sGsqGaKbtXnnVhsOUnTlzy4jGH9mYeRKQT3kM\n0x+tlrnN1FsUHSXTd1hiDbDT5NOdB8KvJc1BfphXLdKlO/2CD0Emu9cmcdRW\nlmqVkkTXeSBmcxJQO9yNnSRFEluJQWnmzS82OTkyOTE3QHByb3Rvbm1haWwu\nY29tIDw2OTkyOTE3QHByb3Rvbm1haWwuY29tPsLAjQQQAQgAIAUCXyZgcgYL\nCQcIAwIEFQgKAgQWAgEAAhkBAhsDAh4BACEJEPeN6qEh6jMNFiEE6F+P7Trm\nZrCPR0fE943qoSHqMw0IQAgAmzNiqHJMt4rFP4RWCHCs8DmlWayenRhZ0T5t\n9oPrCypekP9ntrZlUKJhPUP8HOnPY09shnz1KdGihzsiCsKJihSkRIroNjWQ\nvF9D0e/iBOflCvJ4PeB2NUb9ycz9hI/qBZt6CQudkDhXRxkGYoZTZkr+Jisl\nUXaD6hwcMwfXFWSUw1NuScRa6MQnYQXbWuShuiByHDOKQoyncC3HEs06pGYc\nL0zgS755U/cSQCidCcYmjKG1NnRLxsXz7H7BQ8V/YbmOsXsV4T1BGqreEo0c\n5IU9+3JuYR/w2gOhKdAOLSSteYmSRVINkW1gljvXaYQdbx8B32K3BRZLK6Pv\n8adEEsfDBgRfJmByAQgArFXMNVjlZQk5mQaYBDuf4lIM9elvNjSBi7By3leR\n5+O8Oy0p/wSZV6l4sWOY40zDTeG+mqFbaJEB/jKcyPXAJziRLCuFs3xrU/5V\nhYDGcxWW5QhnIzZgJrCQs8Ie6wolQufbW5jtXwPrDPFwUXroYRlFouE7w3BK\nWnbbYBCN6gtmpcMDNXhv0HkQHivz0ZGtFmngFy5M/XPz4FnrmU/akP50Rs8w\ni28UWevr1ZhRqzO90YHhOgqu4pvRVKq9mXNfT86g1Urp3mD3bn3Cyv5dA4J3\neQBT3r8rbM29QJmZAa7K/QhtU06tiFMK9q4qD/xBSazRx8DLuHHA+yHVrBgP\nrwARAQAB/gkDCPzNXvb1Na64YOvHKMsJwgjon0fPC8WmVAeUE4E5rMySoV3m\nDVDMX0rMmhvDFEIe7wofHP97C90vob2mQit+MSNJsvMcHgy46Gsj2TP8/MHS\nnr/fFcHRJK0y4dFxqJILMo9cWAXD6cAelQeFkFpQOhkGJSqrn2UHD4IF4aqx\nMRJZ46YEzU8ldVMHkrOV+asJQEmzWv8EJhVqPDOYqU+tJadPt7nlvmUuZCzt\n8cw4B8J0NpCPaGm9LJbEnGptvMzjq84J9bRbxXV7oAVU4UlJRx7f+Vh4Kwxk\nLDCC5TZlkpzrvog/0DVJjykTmK+NivA9gMXlkUaASM4MBVTd0MKZLozB+W0N\nrkzAYZJgF0e31xJL6z3aJ69EwVSr9TbHLHOIeVQlJf4uItFRJgwWS5nmXemO\ncPHeLPgU1hNIm2L1PnH2kkM1Ej/0pDFBle2LnhszmoJ4xY0o0cklPtgc9bbo\ncJ9Vr/E+L80BDiMtPslOmnQ/2pLqd0/VHOi/Lo2SVJIVTlG327M0KBEYTOsx\ni5IJuwiuLHFCsxPSxipkHlkhTw06Enjgv4CudYWv/59btoVmV0/PQOXN2gfx\nySkY+8FytFEXLwlytOcvwbvtSwyUL60zjwNFCF3fri3fDp/ONGTViIkBnklB\n1Zn/tMvujIVlPFmeKoi3+DJYvIVSrYJr0igTkwQKlKpgfOIsWSJfx8wNY0lq\nq/ma7TYQ2RahbhKYkMFMBv3tbhnG1+98Z7N7ZDu0GhqQvrpDlrky2W8IZqNH\nWbLBhhzVc5MjSL5ifZlG1TQi0WURr6RkGy0d2JVl0FbG1yK6TXYWQui8I6PX\n8DsMSL0nFA7x0E7TnVN7o+WwMo/AigEip3bI2oCMZTl9DDmrgqYW2VTR9M72\nfOkU3XM5O7YExXwH606Kjti8lTbIYs/bvY5IosLAdgQYAQgACQUCXyZgcgIb\nDAAhCRD3jeqhIeozDRYhBOhfj+065mawj0dHxPeN6qEh6jMNJPEH/jONe9Li\nYG4nmU+SCa3EihBFVFRgboF9FSppYE8D8SIviLhT2dmclmA8UzuGpWTRVUXA\ngYvPc1K2jE22Ly9v3dwj59Md2LCet9WSU+u3fYqINceVcdvjrY/kF5OMsUgQ\nkegY9yAcY6aAaM9E9ouWZhYGcAbgmfACH4xTkl+eK4bJkHkK8gcdGdNycx7W\nQHpYTKOIvUMIPqPMm8i4RWolrnaXLFaJO1Z9pVdKW4UUg4+MpRyPOYYIlWIA\nLQZ34qbghEr4vwl2ekYetulV4OVoR8izM78TIZOqMltfykpiH58iAfXdddND\nh+UKDBBoA59lhCqeZ4WCMTslRNvhLIxTBAM=\n=oipr\n-----END PGP PRIVATE KEY BLOCK-----")
	key, _ := privaetKey.Unlock([]byte(generatedMailboxPassword))

	keyRing, _ := crypto.NewKeyRing(key)
	SessionKey, _ := keyRing.DecryptSessionKey(pgpMessage.KeyPacket)
	fmt.Println(base64.StdEncoding.EncodeToString(SessionKey.Key), SessionKey.Algo)

	fmt.Println(base64.StdEncoding.EncodeToString(pgpMessage.DataPacket))
}